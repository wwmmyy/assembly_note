# 转移指令的原理

**可以修改IP,或者CS和IP的指令**统称为转移指令

8086CPU的转移行为分类:

1. 只修改IP,段内转移,比如:jmp ax
2. 同时修改CS和IP,段间转移,比如:jmp 1000:123

由于转移指令对IP的修改范围不同,段内转移分为:短转移和近转移

1. 短转移的IP修改范围为-128~127(一个byte)
2. 近转移的IP修改范围为-32768~32767(两个byte)

转移指令分类:

1. 无条件转移指令(比如jmp)
2. 条件转移指令
3. 循环指令(loop)
4. 过程
5. 中断

## 9.1 操作符offset

offset是编译器来处理的符号,表示取得标号处的偏移地址

```assembly
code segment
start:  mov ax,offset start ;相当于mov ax,0
s:      mov bx,offset s     ;相当于mov bx,3(第一条指令占三个字节,所以s的偏移地址为3)
```

## 9.2 jmp指令

可以修改IP或者同时修改CS和IP,无条件转移

## 9.3 依据位移进行转移的jmp指令

jmp short 标号(转到标号处执行指令),短转移,这个标号会被转换成偏移地址,然后此汇编指令的机器码中会包含这个地址;这个机器码中的地址只占用一个字节,这就是短转移范围的由来

## 9.4 转移的目的地址在指令中的jmp指令

jmp far ptr 标号

实现远转移,段间转移  
机器码中包含了段地址和偏移地址(区别于jmp short只包含偏移地址)

## 9.5 转移地址在寄存器中的jmp指令

jmp 16位reg

它的功能是(IP)=(16位reg)

## 9.6 转移地址在内存中的jmp指令

jmp word ptr 内存单元地址(段内转移)  
这个字单元中放着要转移的偏移地址

jmp dword ptr 内存单元地址  
内存单元存放两个字,高位是段地址,低位是偏移地址

## 9.7 jcxz指令

jcxz指令为有条件转移指令,而且都是短转移,机器码包含的是位移而不是地址,对IP的修改范围是-128~127

格式:   jcxz 标号  
操作:   当(cx)=0时,跳到标号处执行,即(IP)=(IP)+八位位移

当(cx)!=0的时候什么都不做

## 9.8 loop指令

循环指令,短转移

指令格式:   loop 标号(cx-=1,如果cx!=0则跳到标号处)

## 9.9 根据位移进行转移的意义

jmp short 标号  
jmp near ptr 标号  
jcxz 标号  
loop 标号  
他们对IP的修改都是根据转移目的地址和起始地址之间的位移来进行的,**在对应的机器码中不包含目的地址**,包含的是位移

这种设计,方便程序段在内存中的浮动装配(不管程序被实际放在何处执行,效果都一样)

## 9.10 编译器对转移位移超界的检测

此时编译器将报错,无法完成编译

## 实验九:根据材料编程

[./实验九](./test.md)
